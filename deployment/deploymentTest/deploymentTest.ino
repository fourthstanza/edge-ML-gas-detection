#include <fourthstanza-project-1_inferencing.h>
#include <iostream>
#include <TFT_eSPI.h>
#include <SPI.h>
#include "Free_Fonts.h"

#define BUFFER_SIZE  1800
#define WINDOW_SIZE  80

TFT_eSPI tft = TFT_eSPI();

int xpos = 5;
int ypos = 40;

// Callback function declaration
static int get_signal_data(size_t offset, size_t length, float *out_ptr);

// Raw features copied from test sample (Edge Impulse > Model testing)
static const float input_buffer[BUFFER_SIZE] = {
2.0, 0.9836743418021793, 1.39196810346994, 0.45857462462598764, -0.02106618159913977, 
2.0450270717483874, 1.101296517815955, 1.4693314199734353, 0.45935861218996876, -0.015617314099636445, 
2.0947068939696023, 1.2233231098333999, 1.5482837751108234, 0.45944494705708006, -0.009489704127929563, 
1.9634387485549316, 1.3487124328060867, 1.6274957343477747, 0.4594687954619274, -0.005473114880900565, 
1.8907921658599527, 1.474290972448725, 1.7032503865317763, 0.4595145308860416, -0.0006811403198396077, 
1.914843765170997, 1.6040098856710976, 1.7805318931100729, 0.4600541984197653, 0.0028282810934348638, 
1.9086426448547325, 1.7347741219435595, 1.8557700262125327, 0.4607451364815498, 0.003403905114055009, 
1.9213381786762653, 1.86145137603934, 1.923703827898883, 0.46079530486239295, 0.004113235865374787, 
1.8819548162204107, 1.989259857461063, 1.990476461615672, 0.4608913392633815, 0.0032591187863344417, 
1.9524254722791188, 1.9880512569164184, 1.9892675821799068, 0.384611388690754, 0.004438874410617476, 
2.0062291675629877, 1.9875039430990986, 1.9887060524884528, 0.30377905726821813, 0.006357564096139003, 
2.0092566342822127, 1.9833243865017116, 1.9843692625772178, 0.21172339705881404, 0.009114922317769543, 
2.0755026115579627, 1.9863949114880897, 1.9874430295517012, 0.14566047169844484, 0.008339926807984213, 
2.092227780359391, 1.99133454508573, 1.9922348848497209, 0.10284892333210698, 0.007473807473039158, 
2.026836065532488, 1.9996383621518743, 2.00047597214526, 0.06758092167858715, 0.0064315405012358865, 
2.0449357027475648, 2.0073030308216273, 2.0080095359402907, 0.051748515080501836, 0.004371200421174324, 
1.9806623912856902, 2.0122747741984472, 2.0128593067751535, 0.050468366737519976, 0.0019479411868536878, 
2.036270050671273, 2.0183791699828144, 2.0187063187424354, 0.045508086849977085, -0.0008007567770145317, 
2.0278339884114067, 2.0222663234396157, 2.0225221174489083, 0.045259177307300974, -0.0019331801552207682, 
2.0125671483369802, 2.0240240993614034, 2.024277193132832, 0.04511137077227736, -0.0016950336748130339, 
1.9698263034221968, 2.0268183410725533, 2.0270796177302497, 0.044647051657943776, -0.0011589740918895271, 
2.047704838229309, 2.02658187076218, 2.0268377048533677, 0.038877654399624845, 0.002993946490248203, 
2.0312773435707845, 2.0326588894681823, 2.0332464137516237, 0.04381613775547734, 0.006201126257837617, 
2.0008860727053803, 2.039522645792654, 2.0402617908432434, 0.047795513133570916, 0.0068523802170202715, 
1.9796251487702796, 2.042053112994127, 2.042821556781906, 0.04748578123222499, 0.006550670694273289, 
2.0146199275879386, 2.0447481721375578, 2.045461349165221, 0.047613733560807454, 0.005537742249343961, 
2.0343535823115926, 2.046054706614231, 2.0467682715677076, 0.04744140146583578, 0.0067239655230576295, 
2.0539645016606127, 2.0515861291833044, 2.0523604744406208, 0.049076365299750874, 0.007051634536285111, 
2.071719086591994, 2.0565537692641054, 2.0573219910058937, 0.049419547169063556, 0.005625991445625275, 
2.1894600796554227, 2.0601791623356918, 2.0608412989700446, 0.04823953642184431, 0.0021682818278170985, 
2.1366561667240322, 2.0555844118676707, 2.056352903011229, 0.0529265582172268, 0.0012591070806263409, 
2.085423177971135, 2.0546980824819534, 2.055480252738734, 0.05389408045730873, 0.0008867167133418766, 
2.0237833375805923, 2.058338134979218, 2.0590720555155912, 0.0530313746530911, 0.00024077425466793135, 
2.057174602298033, 2.0647895089223685, 2.0654264106041724, 0.051088719086957536, -0.0021016647537672596, 
2.1163367495165817, 2.0657813559258886, 2.0663974417487334, 0.05115022332448292, -0.0036133715612616138, 
2.092049389629802, 2.0661246155990156, 2.066735806916873, 0.05146324203652905, -0.00473152104790107, 
2.02783259256758, 2.065306210811966, 2.0659248929749334, 0.051846066221007805, -0.005295973652840848, 
1.9741888307409685, 2.0638150702194284, 2.0644376451142943, 0.051823942752512175, -0.004569377880787688, 
2.0170960733993053, 2.057784280129813, 2.058173065884097, 0.14828263530069766, -0.001308013668814797, 
2.059126912661616, 2.055020648172987, 2.0553317759403256, 0.4611596460053591, 0.0015532026304983112, 
2.082847131860685, 2.057138397105223, 2.0574968462613668, 0.9759104648501591, 0.003055402918417805, 
2.030489479644261, 2.0622435529391367, 2.0626133260642283, 1.7249449164874506, 0.0031787235440736317, 
2.0398457370816248, 2.0653572103083926, 2.0657539844748527, 2.721862784960186, 0.004262677022637546, 
2.040870025067825, 2.0661375038214507, 2.066555586906722, 3.9779590721270957, 0.004382885288304917, 
2.0478608371113918, 2.0617637219492977, 2.0621973081810587, 5.529853149102591, 0.19310198664776443, 
2.0929674382215744, 2.663533698888901, 3.533733007053164, 6.048657253868494, 0.5365211160192045, 
2.0924380554148194, 3.840997547164695, 6.270492703513398, 6.18270465126318, 1.0033718617346579, 
2.11930716088691, 5.559753686019523, 9.670513631656972, 6.190956185275994, 1.5664926193816886, 
2.1054658309232073, 7.794906375143066, 13.5151130484124, 6.20723508052106, 2.1997705759263604, 
2.106993120206125, 10.528969780739448, 17.710143879987285, 6.296475504794373, 2.872649089212045, 
2.1288214457255186, 13.732807726210938, 22.156108774531425, 6.459970543083906, 3.560346101389213, 
2.0220688796753508, 17.387046967256662, 26.82269105809278, 6.677804891851741, 4.236266465224809, 
11.656152223601236, 21.459879262755372, 31.64630159769116, 6.899730957640593, 4.879222678254909, 
20.813610403153668, 25.93624142074703, 36.61184820568586, 7.093705741679246, 5.467930473050946, 
29.517194295076557, 30.795975927044466, 41.69702954340411, 7.264217128470669, 5.982649063373446, 
37.821569938638305, 36.024550581225725, 46.88209782568432, 7.405615315087024, 6.402436264787902, 
45.827861621402796, 41.602457032368655, 52.147697329312585, 7.4958015514539085, 6.708766996327174, 
53.291896607188086, 47.515145056208034, 57.4772853972059, 7.4888988043496925, 6.881176199716438, 
60.507673593813216, 53.74081383959174, 62.849156303237464, 7.305777528499936, 6.902830966873881, 
67.20618675304718, 60.26270172948433, 68.25206710433947, 6.819161125685446, 6.7595804963276285, 
73.66965536497793, 67.07949792546613, 73.6845444645623, 5.759710080195214, 6.431594020198361, 
79.84871953898057, 73.56408945453256, 79.07832637121784, 5.333820463961093, 6.117530230763702, 
85.7496325223149, 79.72916214335399, 84.36910858787462, 5.284503494374115, 5.817036061834467, 
91.36581037917388, 85.59180695417191, 89.52191800160124, 5.366616355950853, 5.529749448559141, 
96.70847421235328, 91.16638397902112, 94.51490282716458, 5.427888091077962, 5.257350413974361, 
101.7176936543453, 96.4658205811572, 99.33848702178574, 5.398849217099246, 5.000817762477959, 
106.47902768400695, 101.51136543787013, 103.986675491896, 5.272351500812324, 4.756822469721722, 
111.09080801538424, 106.31007798438081, 108.45454724625941, 5.062027656168208, 4.525634430142046, 
115.4096166886642, 110.87980958458942, 112.74190187959434, 4.819387673170699, 4.303923146902162, 
119.45477342429638, 115.22834093495939, 116.85033868056013, 4.591193707034034, 4.09347617895698, 
123.31951126816331, 119.36618541000664, 120.78391004651408, 4.375076027172122, 3.893111738860861, 
127.01480233622569, 123.29839992962013, 124.54124538757466, 4.165459284217553, 3.703885881886443, 
130.61884725558005, 127.03782732037365, 128.13105207513172, 3.9631727184863697, 3.523982813402295, 
134.02061431459498, 130.58947191765668, 131.55356945101207, 3.764326916146928, 3.353604862943329, 
137.28707433798402, 133.96844069860714, 134.81996268476377, 3.5757687972634393, 3.1908525128628726, 
140.32189235638486, 137.18342758640455, 137.93642718658273, 3.3977523781221266, 3.034327822078797, 
143.24615697089772, 140.23431885161898, 140.90151488480709, 3.220451614478553, 2.8877395623254043, 
146.0542311397366, 143.14008208610437, 143.73252345447656, 3.0544137977267725, 2.7479063154399332, 
148.6650648361307, 145.90784949035992, 146.43378345651527, 2.9027445209650216, 2.61371836434415, 
151.19664863123, 148.54521378925836, 149.01215030078518, 2.765126353148941, 2.4855740966377584, 
153.53478776888193, 151.05901105932725, 151.47378219165904, 2.640312183763079, 2.363233722215335, 
155.7811941495528, 153.4493243987838, 153.81860811741086, 2.5200249933799808, 2.24838728364484, 
157.91881788876557, 155.72445057755237, 156.05387212591128, 2.4062874758029715, 2.139116198745197, 
159.90506825881448, 157.88497477584264, 158.1793947861478, 2.2937769479237855, 2.035532068132857, 
161.90182844043062, 159.93986178809809, 160.20291249948818, 2.188048152622287, 1.9364119664754498, 
163.7390518923853, 161.89339610462218, 162.12867260678402, 2.085647873462532, 1.8404342469723864, 
165.5173400505383, 163.7428673798693, 163.95329028551905, 1.9800707167315337, 1.748789719121681, 
167.2355586573277, 165.49865287133713, 165.68661335900154, 1.878062104039591, 1.660508215375132, 
168.8638606868851, 167.1632300953521, 167.3312401168667, 1.7759144859086144, 1.5770744958290719, 
170.42263317489247, 168.74697410121104, 168.8969965390314, 1.6814517848849073, 1.4985598397494844, 
171.85546151062783, 170.25783152770657, 170.3920327676594, 1.5955080536564732, 1.423331362458227, 
173.20008455247194, 171.69401894490912, 171.8139954073448, 1.515016644645063, 1.3519531188245741, 
174.50270603528344, 173.06426027721673, 173.17132287513058, 1.4448791976032298, 1.2851059218315777, 
175.64577154369047, 174.3712863277508, 174.4673607144689, 1.3791706203082816, 1.222368064745436, 
176.75763269961598, 175.61516517845658, 175.70133407451252, 1.318912120538574, 1.1635965813705385, 
177.82988421546975, 176.80120222607346, 176.87873001653546, 1.2629881733177148, 1.1070031956782598, 
178.87469186262484, 177.92390491819685, 177.99371937646436, 1.203605595304001, 1.0541739224738682, 
179.95491297348113, 178.9897860156192, 179.05283960880607, 1.1267282731892825, 1.0040064612336255, 
180.8978165640064, 179.99819461850723, 180.0552717289435, 1.046281166434885, 0.957584273516606, 
181.82892957573642, 180.9576173046276, 181.0093721458862, 0.9673639437444334, 0.9151255057947698, 
182.81424524897588, 181.87601051664896, 181.9231142710215, 0.9122074579258364, 0.8726902480198766, 
183.6411135036779, 182.7438250353379, 182.78659989830916, 0.9388251311929311, 0.8336961421266881, 
184.4939328124081, 183.57822960353474, 183.6169928586143, 1.180022464739001, 0.7954124278145032, 
185.19880173130224, 184.37826619939983, 184.4133025376216, 1.6790632500719445, 0.9502890810112572, 
185.9179582456422, 185.7574989991966, 185.8204517831043, 4.529474152488629, 0.9434239496707837, 
186.55717082110107, 186.66126776306749, 186.7234098522162, 5.4654736402060795, 0.7990933752387608, 
187.20622448855366, 187.10702222519222, 187.16100649004102, 5.845888594948278, 0.5391917843212513, 
187.8943759448138, 187.11366808619874, 187.1674317303499, 5.970674837020211, 0.1830770484082281, 
188.38773833430633, 186.69733924251688, 186.76996418010086, 5.989720719242601, -0.24947604927510564, 
188.99624463483983, 185.86554522242136, 185.98376818564915, 5.985444197825522, -0.7356567132693504, 
189.55821823345752, 184.6455775867015, 184.8396676444871, 6.002340745804716, -1.262309026668953, 
199.89760901221825, 183.0391301413226, 183.3418498192158, 6.05883633272108, -1.8112263346038606, 
193.33499208455936, 181.0635515809635, 181.50738525275818, 6.155190884391804, -2.365935422713551, 
187.08698436747702, 178.73356281167526, 179.34720224885203, 6.246549629087736, -2.9090738026609437, 
181.00415034011036, 176.0643090103809, 176.87136776040472, 6.330489324371977, -3.424531238685789, 
175.16766807682671, 173.06911485249591, 174.08498431029466, 6.405000985356308, -3.8972099743552024, 
169.50554092744764, 169.7523032120262, 170.98298478803122, 6.469544368313966, -4.311522154796094, 
164.1216313321598, 166.13308889592912, 167.5742500629624, 6.518173578992915, -4.655347490194672, 
158.79077368634586, 162.21728281576566, 163.84846838632652, 6.526896556358458, -4.915422469781226, 
153.58954476555675, 158.00580024103564, 159.79193876477925, 6.465753824267459, -5.07751273301883, 
148.6381379370304, 152.8988733542405, 154.62545062731095, 4.972505699938295, -4.912446508989557, 
143.8491100003913, 147.96034354406527, 149.63179463321165, 3.996826511255066, -4.754983023699101, 
139.28311796239373, 143.18092781818444, 144.79926121932152, 3.4983367131324568, -4.6039308029287955, 
134.82538969729802, 138.55432682993865, 140.12296412527107, 3.365931613092329, -4.457165388715869, 
130.4803092767531, 134.0806937904261, 135.60010184982082, 3.4080269381523247, -4.314815493037548, 
126.34334735222434, 129.75244524393688, 131.22424763389793, 3.484198952379617, -4.178480696848004, 
122.17449703777739, 125.5543697960577, 126.97950458486245, 3.5228425695431786, -4.044974394997062, 
118.18677882349589, 121.49219204405819, 122.8728712851442, 3.489619070385042, -3.9149039557079313, 
114.31851512175558, 117.56954567155566, 118.90745153108394, 3.378065785609899, -3.7887815238514406, 
110.6163327533844, 113.77852396313097, 115.07367528622184, 3.2675927764383363, -3.6638420431230503, 
106.97853452817748, 110.11863105725523, 111.37020753677598, 3.155377425380496, -3.539534150376166, 
103.58953944462597, 106.58392709986877, 107.78951740929529, 3.0454382419572164, -3.4180676057904553, 
100.25356418362, 103.16231086948858, 104.32285416947512, 2.942275357429307, -3.301682573179868, 
96.9524241660929, 99.8469708337427, 100.96508499706242, 2.846696080198512, -3.1917704780917706, 
93.79592965435376, 96.62670845174279, 97.7044132473973, 2.766736722964672, -3.083137028838602, 
90.82720280551617, 93.51895085332997, 94.5584763078553, 2.682880924761654, -2.9806122480815, 
87.98179060223549, 90.51303770732991, 91.51696716361437, 2.601775408126923, -2.882543278858621, 
85.29082350637943, 87.60818138856585, 88.57882704429076, 2.5200916389269983, -2.7892951840928477, 
82.72785464421042, 84.79800437200623, 85.73715161150055, 2.4408845925902165, -2.699302768276136, 
80.07953001121504, 82.08492653882517, 82.9948772299027, 2.3569221072181663, -2.6123649750241307, 
77.43486870481898, 79.46215194886885, 80.34194899005665, 2.27479813248523, -2.5271417368856075, 
74.81914924022561, 76.92637603727864, 77.77705428264758, 2.1929546117048657, -2.4451524674673935, 
72.45037546317236, 74.47813956635198, 75.30237074880681, 2.106819251571199, -2.36893532999977, 
70.0921684874949, 72.10907702404612, 72.90973536182045, 2.023153447059851, -2.298156568436836, 
67.84081402153072, 69.80937317579186, 70.58821700205685, 1.9500390196247763, -2.229054644982106, 
65.65350048843057, 67.5802451157933, 68.33707056682131, 1.8854884118192416, -2.1603554386547317, 
63.56928919728049, 65.41721609364754, 66.15014189955312, 1.8325570912427473, -2.0884791832641674, 
61.62514600532491, 63.322306284999044, 64.02690714650952, 1.788817309705113, -2.014860578004097, 
59.68114959817653, 61.296792333926305, 61.97325016922598, 1.746302231445977, -1.941926663791429, 
57.78064063126631, 59.34671830746786, 59.996007396069096, 1.6965586228126566, -1.873521045101391, 
55.89092897745982, 57.46722488391055, 58.09299987115476, 1.6387479952589747, -1.8116077973471132, 
54.031941233448165, 55.64363117765376, 56.247350521574006, 1.5869466053147483, -1.7521617360309096, 
52.3157416422587, 53.87966039838918, 54.46346346977889, 1.5351385198542962, -1.6960156927724384, 
50.682359152047255, 52.17277205426009, 52.73794600488304, 1.485648721736001, -1.6390324756804093, 
49.209297705834466, 50.532607908650874, 51.07805916963672, 1.4294722121036654, -1.5856634892071577, 
47.67130679405122, 48.94287318625878, 49.470067916961376, 1.3788890964220732, -1.532972921915515, 
46.23368428148377, 47.40403131762041, 47.91151697439425, 1.3346650165862206, -1.4816612288898294, 
44.747254463308686, 45.91144777862348, 46.40043260320447, 1.296550357066303, -1.4304766984354853, 
43.27287616306365, 44.47216755243446, 44.94240224823622, 1.2563397436558108, -1.3807684066540016, 
41.86863601926152, 43.085160575996866, 43.53800542816154, 1.2112289500872837, -1.3343797906062327, 
40.53060051546542, 41.74848997346699, 42.186480234413494, 1.160531687163902, -1.2918324950883353, 
39.41087415868305, 40.45594054488198, 40.880174841144246, 1.1110439285949865, -1.25211508690629, 
38.133533639006934, 39.202151051928375, 39.61376636674303, 1.0669456184992032, -1.2130799309098015, 
37.003676107110984, 37.98361593954063, 38.38074017863448, 1.0324234389107303, -1.1735108390318256, 
35.79981297422581, 36.80265663110139, 37.186020328385254, 1.0011722704124746, -1.1363934027651625, 
34.75215701224189, 35.65223859586811, 36.02220656609366, 0.9793863420837409, -1.100246894857209, 
33.69881735445834, 34.537676742758705, 34.89596208973841, 0.9601440939362914, -1.0649963313460977, 
32.64521159297007, 33.465989342646935, 33.813523921713475, 0.9346306042030693, -1.0300021289932606, 
31.634950784898596, 32.43943751908215, 32.77582476515625, 0.9001469444687193, -0.9971494313200882, 
30.62172726478958, 31.449132899380224, 31.775315246485913, 0.8628508695675077, -0.9664267658473311, 
29.71273590763046, 30.481860840862886, 30.79607812734764, 0.8384221440639003, -0.9334806465345055, 
28.77595785902349, 29.55058371392476, 29.853795171226793, 0.8100493489146564, -0.9012029861908496, 
27.826995717751387, 28.651216111378382, 28.941856618849016, 0.7836212363325215, -0.8690090951586004, 
26.914264813558077, 27.785018085382426, 28.06450416827715, 0.7535651731633899, -0.8399589915750271, 
26.125877761275348, 26.941244427073634, 27.20958927808093, 0.7320431897106204, -0.8095539127108641, 
25.44380684222495, 26.1276302714186, 26.38404000401627, 0.7119837500399525, -0.7796530742422703, 
24.685726600234624, 25.34239116875029, 25.58739105090471, 0.6922317500335474, -0.7497078505378199, 
23.934521222405596, 24.588130316785218, 24.821263502389442, 0.6696761781842749, -0.7215142515088981, 
23.233099607996852, 23.86047132518255, 24.08324258107193, 0.6449845369574218, -0.697410544868229, 
22.613794466369026, 23.148956857471248, 23.362802393459305, 0.627990633301984, -0.675507511068136, 
21.940644558290508, 22.456849024477076, 22.663905577887878, 0.6143400027019642, -0.652941823384688, 
21.251778479301237, 21.79819868347927, 21.99857313449395, 0.5897836276972611, -0.6311467620737822, 
20.680990863977772, 21.17111649363585, 21.365252652008508, 0.5548603113058984, -0.612835630580549, 
20.08138595027711, 20.560863876047925, 20.74959716282035, 0.524073075770606, -0.5960511969746107, 
19.566777153457455, 19.961366954954077, 20.14420908420327, 0.5048431454228054, -0.5765322957875687, 
18.97918339914686, 19.38565848170331, 19.56191809671657, 0.4831063898531616, -0.559650378915503, 
18.328504424249633, 18.823911413030917, 18.99545476306668, 0.46391545250545513, -0.5450185905770702, 
17.702232531116767, 18.275562863088382, 18.443389244113103, 0.4394227706191565, -0.5299140250872442, 
17.288590261786535, 17.742723143825383, 17.905369074185337, 0.4683963412348398, -0.5144021656527246, 
16.880949776063343, 17.225355149709866, 17.38338808790467, 0.5700212854225271, -0.4993427712105547, 
16.361835879868522, 16.72699992335853, 16.881174087484904, 0.7408997016913239, -0.4857219918925091, 
15.851856104723362, 16.24049306389968, 16.390185280506074, 0.9653854678796607, -0.47082727819721154, 
15.474391028222342, 15.770383045899974, 15.91519107559219, 1.2309490818754472, -0.45443694373070587, 
14.946568123647337, 15.315914923766044, 15.453576104542748, 1.537198241975918, -0.630354586635399, 
14.459522808916295, 14.26054426794032, 14.716446021229252, 2.084439777868026, -0.7759232893626964, 
14.08835895816105, 13.247381572527319, 13.994936511576434, 2.402859847088279, -0.8972772686542948, 
13.662756652442248, 12.264567400390863, 13.2859706869396, 2.61430850272299, -0.9923596306814969, 
13.278094857679857, 11.30763687192156, 12.573007358777836, 2.746352819656432, -1.0589523907391072, 
12.896881112636155, 10.373230805862503, 11.853397210981555, 2.8271192424327047, -1.0981240732496247, 
12.55962566228179, 9.467350815097298, 11.135043910667413, 2.871976242540536, -1.112593921658651, 
12.295287199314604, 8.591291276143698, 10.416071641642612, 2.8917008069552943, -1.1026156058696355, 
2.0932529059352807, 7.739118121430042, 9.681942603324993, 2.8966360494441594, -1.0650707743444026, 
2.1179012976416, 6.924872090103622, 8.944696228118264, 2.8951682090060973, -1.0072653378848604, 
1.9772057769334987, 6.136855246796138, 8.194780308187902, 2.8948178396656723, -0.9276336609539437, 
1.9777018062776668, 5.373545512420619, 7.414116888791359, 2.8872032879804763, -0.8255491414588529, 
1.9304527191184446, 4.636188381701091, 6.596938363081794, 2.8660102223867088, -0.7028823634163299, 
1.8677560276252603, 3.922909065041639, 5.719955686037834, 2.823403748445648, -0.5582113022482087, 
1.8349034814657461, 3.2384757075004797, 4.74962799610834, 2.752011014409252, -0.39338244132592654, 
1.8396205528038356, 2.5776454916954425, 3.5981316003835553, 2.6412232415296053, -0.2076379424371326, 
1.918631622424621, 1.938479714515629, 1.9405214939203488, 2.473760249781877, -0.0023948644116367074, 
1.851253315996554, 1.9357182334582335, 1.9375718630060645, 2.0316941140180496, 0.0019535416664610197, 
1.8754032081527359, 1.928346419290894, 1.9297224341953207, 1.6381848039191784, 0.0068111173599222485, 
1.865042560929811, 1.9289290520642197, 1.9303207179591664, 1.265794296406713, 0.009212023171530782, 
1.8656257911286216, 1.9305163468960518, 1.931956722593066, 0.9388844740201928, 0.011759028250780228, 
1.9459473919776047, 1.9356898111109087, 1.9372297927210196, 0.6511148403149485, 0.011862042704414594, 
1.9863422094011995, 1.9405913493992504, 1.9420487703486673, 0.4005646242300768, 0.010808243879460748, 
2.068634764437584, 1.9483900650014283, 1.9496528733783005, 0.19411341784065647, 0.00919152903057306, 
2.0490692090169524, 1.9571277924039285, 1.9581920484425688, 0.06189471801390567, 0.010346901046362747, 
1.9999522709641675, 1.9705607538029708, 1.9720418400381108, 0.06646353920322955, 0.014339958802901611, 
1.9865279013067123, 1.9939909109759864, 1.9961169523414863, 0.07951248573625593, 0.01442412251194347, 
2.0030985235869787, 2.010592013911225, 2.0127493526842746, 0.08315039187635387, 0.013577924580304386, 
2.0132281465561546, 2.0254408991753694, 2.0273320875052403, 0.08409222039832165, 0.009922733577393605, 
1.9461806402387294, 2.0338033182468607, 2.0352878330260786, 0.08257547795658317, 0.005257783687760412, 
1.9596829311005926, 2.0349358813103726, 2.0363754326569694, 0.08302209872141654, 0.0026003340880938427, 
1.979424191243838, 2.035064145789057, 2.03650060649469, 0.08223423875453223, 0.0021826950680449548, 
2.1335590048092974, 2.0346798787713594, 2.0361108188426833, 0.07922210699255532, 0.0023521753614078656, 
2.226135830764803, 2.032198583711965, 2.0336364191274674, 0.07643778563306027, 0.0014381845779882752, 
2.1410208551165533, 2.030246218554991, 2.0317304935984994, 0.07630388341802276, -0.0027965260836870618, 
2.1026247251561196, 2.0213738448733443, 2.0233481823737436, 0.07811554463953965, -0.0066807478411842775, 
1.9994244962724816, 2.0123129670746347, 2.0146840440468243, 0.07861965809577642, -0.010717345258583966, 
1.9640684009938003, 1.9999650168070566, 2.0029160904261336, 0.07999067234190622, -0.014151785489294758, 
1.9883944410601506, 1.9915503164978676, 1.9950069489899764, 0.07793956819821428, -0.01904821724319896, 
2.062486492154422, 1.9807702566358238, 1.9848579503210257, 0.07769846272515912, -0.022742171323875463, 
2.009368488066642, 1.9703978649366187, 1.9749227177296442, 0.07753777573416112, -0.02716156753294842, 
1.9687144284525782, 1.9455493228839549, 1.9504274609359984, 0.08000573092205361, -0.028533672895897477, 
1.844569922400372, 1.911888475176668, 1.9163582349646944, 0.07705424009569047, -0.023346582024051432, 
1.8581244788076219, 1.8944610938601762, 1.8980683678235748, 0.07190720304855139, -0.020254255485531072, 
1.8156609422749048, 1.8758976726671897, 1.878859580135498, 0.07150597458546602, -0.017905417578226283, 
1.8115454352917046, 1.8614937262408349, 1.8643587889603472, 0.07779888007780465, -0.014174652756201176, 
1.7872019733078937, 1.8583539488120016, 1.86109052706801, 0.077311929314597, -0.007342854690773406, 
1.8134659240565563, 1.8653956211186808, 1.8688110007341607, 0.08951845830080113, -0.0019857719581217056, 
1.735982331966675, 1.8624657166429324, 1.8656114625236786, 0.08924956419699034, 0.00445985429525781, 
1.6875622674482142, 1.8613284286421294, 1.864391686996686, 0.08922352281200686, 0.010336345704758597, 
1.86218275405268, 1.8640956163077282, 1.8673442329550745, 0.08963697247180966, 0.017302739252568217, 
1.8056099860683361, 1.8809826758515282, 1.885162054852501, 0.09361826188720544, 0.01967414297467834, 
1.7689613534508073, 1.8922459596216956, 1.8967664391291064, 0.09388959063813897, 0.02146830679955014, 
1.913831962132465, 1.9048840129485283, 1.9094950354741997, 0.09278236944581705, 0.02279619889994516, 
2.1010611979670197, 1.9205267720391905, 1.9252951884696083, 0.09279335258332404, 0.023759591043323078, 
2.0156080205424463, 1.9387417179636317, 1.9434962529998419, 0.09256324156774429, 0.02285751486667468, 
1.9911718800537974, 1.9531673213107408, 1.957760949182293, 0.09219702812102071, 0.021617047112417232, 
2.0129894311021586, 1.9715187295064358, 1.9753307980832635, 0.08681982604189992, 0.016433032565059003, 
2.11476287510117, 1.9874629868616052, 1.9899279196815456, 0.07692761238746226, 0.009562752103251412, 
2.0383370191303003, 1.9921377774034883, 1.9943854724816108, 0.07909524241767099, 0.005805035282850481, 
2.017869795504229, 1.9999402309563328, 2.0016802545487895, 0.07912980971212538, 0.0011097720281449308, 
2.061829580742299, 2.0115558994815537, 2.012455703603519, 0.07401997222899738, -0.005280028682938289, 
2.0786411080989513, 2.012458314926216, 2.013316947643049, 0.07642688917730332, -0.008098898065433647, 
2.0442755776103025, 2.0040996356290712, 2.004853814746911, 0.06227553862177454, -0.0056312734456519355, 
2.029604863097795, 2.0051858174014177, 2.0059502308240202, 0.059911111724937675, -0.0047959590345792585, 
1.9426703851309266, 2.008072865474624, 2.008847158737477, 0.05979425320415182, -0.004249067163013872, 
1.9369794027228078, 2.0105651095523194, 2.011367696278474, 0.05971194370924781, -0.0034650658150592742, 
1.9304492429138493, 2.0064002334052566, 2.0070530879414465, 0.05074485711332611, -0.0006636226756065905, 
1.9548120498543473, 2.006561119198452, 2.00721657797542, 0.04941299680820126, -0.00033625381739021466, 
1.9282706092470543, 2.004911821419165, 2.0055686917891298, 0.05115398903886952, 5.187725607233668e-05, 
1.9673223292127044, 2.0017817558778144, 2.002387377857695, 0.05083738765914651, 0.001275703243336059, 
2.0329869288999887, 1.9971260026443662, 1.9976352889088957, 0.05061148147698368, 0.0054620934248119, 
2.0373646492250983, 2.002428578821538, 2.0031666127596037, 0.0512996847373152, 0.010237955995283066, 
2.0528653363452856, 2.013337685573351, 2.0146619985664613, 0.0603899766263311, 0.014151843653366787, 
2.048124856748165, 2.0292132101658664, 2.030905538894856, 0.06558815588975676, 0.014262382752131608, 
2.040911191821425, 2.0407390930730545, 2.0423891987379106, 0.06395683400717017, 0.012143579381736186, 
1.9914810310356403, 2.04736350361176, 2.048812324440537, 0.061748292806269645, 0.01093112159112494, 
2.0117485320806927, 2.0565904015576444, 2.0579280389958927, 0.06098263912109651, 0.00984234227128398, 
2.0041490563637794, 2.067501051476519, 2.068586440380149, 0.058550440244257436, 0.008067674962542943, 
2.1291167964450484, 2.076807372210737, 2.0777518254548184, 0.05922480708875046, 0.0042994860878162455, 
2.2041505711268057, 2.0743778630668444, 2.0753960508176172, 0.06115560059696007, 0.0030225268107151, 
2.196678778611175, 2.0752078146216224, 2.0762132878823505, 0.06053899070774463, 0.00218451765897067, 
2.1213935292378125, 2.0762982631799902, 2.0772957733845363, 0.06020673848798338, 9.449031010263504e-05, 
2.0364398115331355, 2.0728616968346314, 2.0739502539901022, 0.06058831044920043, -0.0024882783061528514, 
2.102442416988497, 2.068172080939047, 2.069415220985942, 0.06224470506632672, -0.004617968520408175, 
2.102841007949051, 2.0678806895699227, 2.069135112703551, 0.06105510386155527, -0.0076049564898714875, 
2.1162234609601898, 2.066642903918728, 2.067937233453227, 0.06007292527247242, -0.01046603844070749, 
1.99411478259771, 2.0648599689125, 2.0662208807863185, 0.05808263542231464, -0.013456261886210838, 
2.050643874101544, 2.055107011993468, 2.056516540685582, 0.05663104604211957, -0.013830905167678119, 
2.070312513279174, 2.039972002559734, 2.04112853561641, 0.04659512075097008, -0.011849489993315714, 
1.9931397952224295, 2.026232429389357, 2.0270331164588726, 0.035454794281214716, -0.007676505583228975, 
1.9658773374920682, 2.0229333516296166, 2.0236205458094347, 0.04416209562582389, -0.008071714174555098, 
1.986818769129649, 2.014675709400282, 2.0155641267731106, 0.045032367487028796, -0.00980608118737448, 
1.9919439616615764, 2.0023017389393534, 2.0032267646791517, 0.04576841730171357, -0.00927236078416402, 
1.9756220962641267, 1.9914604760334094, 1.9922858966514019, 0.0452616317877394, -0.0077497455586873895, 
1.97306948574055, 1.9815548422619647, 1.982132177761383, 0.0435790568644471, -0.005889505870814934, 
1.9619904201870544, 1.9782825713274352, 1.978880675165576, 0.03986881724361678, -0.008190662468999714, 
1.9768456078851444, 1.965435540042947, 1.9661943174419734, 0.0470037464301798, -0.008038109713004218, 
2.0686082850819623, 1.9540414702467566, 1.9546914643014572, 0.0482394927939848, -0.004691504366050908, 
1.9043175358637898, 1.9549981892896646, 1.9556705027147956, 0.05034324544585418, -0.004724995792114731, 
1.9044588896136403, 1.9518276382356379, 1.9525219908015314, 0.048664999541195665, -0.0039028784514053643, 
1.929380801453941, 1.9513830853747465, 1.9520703867083624, 0.04860328625243843, -0.0029795231603295708, 
1.957733320617076, 1.9495764953624422, 1.9502394116648554, 0.04857380101275508, -0.0018482632891147204, 
1.9417584476452372, 1.9489065695018888, 1.9495624901386164, 0.04871288166440646, -0.0021462468824657703, 
1.8450913735497365, 1.9447768441105255, 1.9454486132396402, 0.054514458431624405, -0.002452262083738792, 
1.8880073965401227, 1.9409572820498084, 1.9416528637427792, 0.06249718590020313, -0.0010047259091777126, 
2.0084472999089553, 1.9420137121079355, 1.9427327397850975, 0.06399722162999902, 0.00139652337869362, 
1.9151485206276437, 1.9395785399160732, 1.9401625046648028, 0.0580958525365394, 0.007643358713688777, 
1.9797059233553886, 1.9536297812267698, 1.954713685704986, 0.05801085219330522, 0.011123152322681093, 
1.9630385214647066, 1.9708768194164397, 1.9726524044299014, 0.0609354021125005, 0.013915313637732813, 
1.96490328249527, 1.9865214553434982, 1.988879710601554, 0.0636653313496456, 0.018105797798141834, 
1.9069938794787424, 2.0052491728933006, 2.0086268680492227, 0.07370624968528554, 0.021877265358075163, 
1.9008774272155784, 2.0242086368358563, 2.0282905792720185, 0.08036797563213204, 0.024845184077654688, 
1.993748488815179, 2.050016843534312, 2.0542289769116984, 0.08313807631367215, 0.02379778619305282, 
2.0296455300121647, 2.0696116950883163, 2.0736418375019805, 0.08345019062269117, 0.0223090219481235, 
2.1291373968349365, 2.0800393024155763, 2.0841345517297167, 0.08200001935194105, 0.02143684410994969, 
2.1804115006483578, 2.0920394095748067, 2.0956824296180234, 0.08302136071795968, 0.019113754648238973, 
2.1796949762868785, 2.102711085363515, 2.1061720157617705, 0.08294046658206211, 0.015809251919218992, 
2.2573768014139146, 2.1085953407839475, 2.111780431647319, 0.08742829801189697, 0.012699398534998428, 
2.2451098707261252, 2.1167607379722395, 2.1196159563337704, 0.08886654374672297, 0.008800573730728388, 
2.25802268072503, 2.126934753531783, 2.1291386856261756, 0.08758163199577523, 0.004539997401119296, 
2.201525021404193, 2.1412290540042322, 2.1426255392059845, 0.08197537365026478, 0.00010116912836517943, 
2.1752890171451162, 2.151319800883435, 2.1523731541491298, 0.08126186033648479, -0.0012269087234548608, 
2.1071502351753324, 2.164539401664479, 2.1654488050947815, 0.08680105974394514, -0.002219095404159519, 
2.1504527359747234, 2.1720202988998487, 2.172997851999161, 0.0932021359581554, -0.004135146905987521, 
2.057186608191623, 2.168068616007547, 2.1690866575370586, 0.090697329589131, -0.005314284818238995, 
2.0955496375079394, 2.1628120361047367, 2.163900079118366, 0.08866673274516126, -0.007961310000840192, 
2.0697781284314387, 2.1474091617419884, 2.1486552414250872, 0.0821400000263352, -0.009123018289930262, 
2.129586234774762, 2.13072694477951, 2.132197286456373, 0.0785483247572553, -0.008029000121475238, 
2.1552004388824235, 2.1191092113232015, 2.1203675636022608, 0.07153017753567587, -0.0056883258010246955, 
2.241159142508868, 2.1127370307519615, 2.1138948057562668, 0.0711986389971315, -0.005320683710627804, 
2.2488317526008563, 2.104450141349765, 2.105610897429286, 0.07095350200132476, -0.006460690354497675, 
2.1171845743715334, 2.0962201845711226, 2.097617089858637, 0.07025618078652379, -0.008503296642435675, 
2.0955896978419113, 2.0856367144028316, 2.0871682031788557, 0.07016016422160902, -0.01065750586800534, 
2.010930811609936, 2.0764973027862856, 2.078462080363118, 0.06713152414597555, -0.01480973714343442, 
1.978194399326469, 2.0632782130879184, 2.0657681408075397, 0.06916167325773856, -0.016983240053059366, 
2.072138945424102, 2.0539269638282676, 2.0567175603365246, 0.06820564637654523, -0.017701331382926382, 
2.0995701322643483, 2.0459186454924625, 2.048659182151696, 0.06840497635543794, -0.016220747023810697, 
2.0426987867099715, 2.0385786717201273, 2.0411340521051202, 0.06984659247573384, -0.016756777324348295, 
1.9754709267170516, 2.016919935265224, 2.0190721834689422, 0.06429230010131855, -0.01408995906815051, 
1.9811172132820696, 1.9969109794206497, 1.9982654139534495, 0.05351340237204079, -0.010193547335247908, 
1.9109560223268915, 1.9860686438110833, 1.9872179329556718, 0.05329707645591536, -0.007800766398043375, 
1.884044202334063, 1.9786558215114678, 1.9796074974412805, 0.0535579183669906, -0.00357159981747672, 
1.920158140277028, 1.9828107358352174, 1.9838932802448792, 0.05849728362866378, -0.0038203631899737444, 
2.0014531414018757, 1.98054881888126, 1.981657231913121, 0.05496661693633924, -0.005147152897696035, 
2.037760858525061, 1.9707424450011422, 1.9717666408151944, 0.05708970025868777, -0.0033028420421999617, 
1.8946193592304157, 1.9622321741226507, 1.9629790269105067, 0.05579604275636962, -0.0023399979533955903, 
1.928688459087669, 1.9516884539851507, 1.952431840545366, 0.06302774341660157, 2.8201977121250472e-05, 
1.9437072046184731, 1.952062540922628, 1.9528108783930043, 0.062442086710196465, 0.00155143946129808, 
1.9769845410480638, 1.9536389192688253, 1.954419624037196, 0.06236410826036376, 0.004100905945475831, 
2.0774094407899266, 1.9627156313701848, 1.9636101062504419, 0.06007724506932129, 0.004081769542565309, 
1.942003728063153, 1.970806573965871, 1.971623556863708, 0.05530200849072107, 0.004135323799145212, 
1.9152369633422137, 1.9795654534912601, 1.9804453552545467, 0.05393406256086974, 0.005633180807667164, 
1.963405798208483, 1.9866848492873999, 1.987831243354293, 0.0760728396168299, 0.008380535259714227, 
1.873999264509974, 1.9913267727687916, 1.9926705877466262, 0.11133099357136018, 0.011604030468393195, 
1.9814563177166884, 2.0047437467328373, 2.006104790768732, 0.15771889928060126, 0.011491280691501429, 
2.0063392668212248, 2.016020586515719, 2.0174216532201514, 0.21229821474219818, 0.01026768817078727, 
2.056183415948645, 2.0220982296887735, 2.023414798915755, 0.26352852721686787, 0.008806239063057, 
2.0134992838650407, 2.0251589052648216, 2.0264400185618654, 0.3212093778973034, 0.007621482715927196, 
2.0603002126832575, 2.0211277337015736, 2.022367515218216, 0.3841315592339444, 0.01047005472001497, 
2.115363474140111, 1.8997525006976266, 1.9632267346441934, 0.38406406308550317, 0.010452951998920499, 
2.1120316342273244, 1.7800501904887382, 1.90394351872953, 0.38372720764684104, 0.009200368260146358, 
2.1092909426551474, 1.657337328100708, 1.8395830443295473, 0.3836830726651176, 0.008772103531498883, 
2.109117895613779, 1.5402123740688347, 1.778924871733843, 0.3825602452393701, 0.0036281079527409484, 
2.0409494953873493, 1.4163713542115417, 1.7085631764978897, 0.38251594374054604, 0.0007805304635582919, 
2.0259553502648258, 1.2909751500352151, 1.6332791554830004, 0.38250828647073964, -0.0025484426082930762, 
2.0129106957779603, 1.1624636865384248, 1.5502766397433307, 0.3824133584534323, -0.004285510595377959
};

static float features[WINDOW_SIZE];

int raw_feature_get_data(size_t offset, size_t length, float *out_ptr) {
    memcpy(out_ptr, features + offset, length * sizeof(float));
    return 0;
}

void print_inference_result(ei_impulse_result_t result);

void setup() {
  Serial.begin(9600);
  Serial.println("Begining setup");

  tft.init();
  tft.fillScreen(TFT_BLACK);
  tft.setFreeFont(FSB9);

  Serial.println("Screen initialized.");

  drawtext("Device initialized.\nBeginning run.", TFT_WHITE, 0, ypos);
  Serial.println("Device initialized.\nBeginning run.");
  
  delay(2000);
}

const float *start = input_buffer;
const float *end = input_buffer + BUFFER_SIZE - WINDOW_SIZE;

void loop() {

    static int index = 0;
  
  if (start > end) {
    index = 0;
    start = input_buffer;
  }

  start += 5;

  for (int j = 0; j < WINDOW_SIZE; j++) {
    features[j] = start[j];
  }


  ei_printf("Edge Impulse standalone inferencing (Arduino)\n");

  if (sizeof(features) / sizeof(float) != EI_CLASSIFIER_DSP_INPUT_FRAME_SIZE) {
      ei_printf("The size of your 'features' array is not correct. Expected %lu items, but had %lu\n",
          EI_CLASSIFIER_DSP_INPUT_FRAME_SIZE, sizeof(features) / sizeof(float));
      delay(1000);
      return;
  }

  ei_impulse_result_t result = { 0 };

  // the features are stored into flash, and we don't want to load everything into RAM
  signal_t features_signal;
  features_signal.total_length = sizeof(features) / sizeof(features[0]);
  features_signal.get_data = &raw_feature_get_data;

  // invoke the impulse
  EI_IMPULSE_ERROR res = run_classifier(&features_signal, &result, false /* debug */);
  if (res != EI_IMPULSE_OK) {
      ei_printf("ERR: Failed to run classifier (%d)\n", res);
      return;
  }

  // print inference return code
  ei_printf("run_classifier returned: %d\r\n", res);
  print_inference_result(result);
    
    tft.fillScreen(TFT_BLACK);
    drawtext("Time index: ", TFT_WHITE, xpos, ypos);
    tft.drawNumber(index, xpos, ypos + 40);
    drawtext("Prediction: ", TFT_WHITE, 0, ypos + 80);
    tft.drawFloat(result.classification[1].value, 4, 0, ypos + 120); //take the value of true
    
    index++;
  delay(100);
  
}


void print_inference_result(ei_impulse_result_t result) {

    // Print how long it took to perform inference
    ei_printf("Timing: DSP %d ms, inference %d ms, anomaly %d ms\r\n",
            result.timing.dsp,
            result.timing.classification,
            result.timing.anomaly);

    // Print the prediction results (object detection)
  #if EI_CLASSIFIER_OBJECT_DETECTION == 1
      ei_printf("Object detection bounding boxes:\r\n");
      for (uint32_t i = 0; i < result.bounding_boxes_count; i++) {
          ei_impulse_result_bounding_box_t bb = result.bounding_boxes[i];
          if (bb.value == 0) {
              continue;
          }
          ei_printf("  %s (%f) [ x: %u, y: %u, width: %u, height: %u ]\r\n",
                  bb.label,
                  bb.value,
                  bb.x,
                  bb.y,
                  bb.width,
                  bb.height);
      }

      // Print the prediction results (classification)
  #else
      ei_printf("Predictions:\r\n");
      for (uint16_t i = 0; i < EI_CLASSIFIER_LABEL_COUNT; i++) {
          ei_printf("  %s: ", ei_classifier_inferencing_categories[i]);
          ei_printf("%.5f\r\n", result.classification[i].value);
      }
  #endif

      // Print anomaly result (if it exists)
  #if EI_CLASSIFIER_HAS_ANOMALY
      ei_printf("Anomaly prediction: %.3f\r\n", result.anomaly);
  #endif

  #if EI_CLASSIFIER_HAS_VISUAL_ANOMALY
      ei_printf("Visual anomalies:\r\n");
      for (uint32_t i = 0; i < result.visual_ad_count; i++) {
          ei_impulse_result_bounding_box_t bb = result.visual_ad_grid_cells[i];
          if (bb.value == 0) {
              continue;
          }
          ei_printf("  %s (%f) [ x: %u, y: %u, width: %u, height: %u ]\r\n",
                  bb.label,
                  bb.value,
                  bb.x,
                  bb.y,
                  bb.width,
                  bb.height);
      }
  #endif

}

void drawtext(char *text, uint16_t color, int xp, int yp){
  tft.setCursor(xp,yp);
  tft.setTextColor(color);
  tft.setTextWrap(true);
  tft.print(text);
}
